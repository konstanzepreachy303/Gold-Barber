<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Painel Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Arial, sans-serif; margin:0; padding:0; background:#fafafa;}
    header{background:#111; color:#fff; padding:14px 16px; display:flex; align-items:center; justify-content:space-between;}
    main{max-width:1100px; margin:18px auto; padding:0 16px;}
    .grid{display:grid; grid-template-columns:1fr; gap:16px;}
    .card{background:#fff; border:1px solid #e6e6e6; border-radius:12px; padding:14px;}
    h2{margin:0 0 10px 0;}
    table{width:100%; border-collapse:collapse; font-size:14px;}
    th, td{border-bottom:1px solid #eee; padding:10px; text-align:left; vertical-align: middle;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .pill{padding:4px 10px; border-radius:999px; background:#eee; font-size:12px;}
    .btn{padding:10px 12px; border-radius:10px; border:1px solid #ddd; cursor:pointer; background:#fff;}
    .btnPrimary{background:#111; color:#fff; border-color:#111;}
    input, select{padding:9px; border-radius:10px; border:1px solid #ccc;}
    label{font-weight:700; display:block; margin-top:10px; margin-bottom:6px;}
    .cols{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    .full{grid-column:1/-1;}
    .muted{color:#666; font-size:12px;}
    .ok{color:#0a7a2f; font-weight:700;}
    .bad{color:#b00020; font-weight:700;}
    @media (max-width:800px){ .cols{grid-template-columns:1fr;} }

    /* ===== Tabs ===== */
    .tabs{
      max-width:1100px;
      margin:14px auto 0;
      padding:0 16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .tabBtn{
      border:1px solid #ddd;
      background:#fff;
      color:#111;
      border-radius:999px;
      padding:10px 14px;
      cursor:pointer;
      font-weight:900;
    }
    .tabBtn.active{
      background:#111;
      color:#fff;
      border-color:#111;
    }
    .tabPanel{display:none;}
    .tabPanel.active{display:block;}

    /* ===== Toggle buttons (Hoje / Semana / Todos) ===== */
    .toggleBtn{
      border:1px solid #ddd;
      background:#fff;
      color:#111;
      border-radius:999px;
      padding:10px 14px;
      cursor:pointer;
      font-weight:900;
      user-select:none;
    }
    .toggleBtn.active{
      background:#111;
      color:#fff;
      border-color:#111;
    }

    /* ===== Confirmados (agenda) ===== */
    .agendaWrap{display:grid; grid-template-columns: 1fr; gap:12px;}
    .dayCard{border:1px solid #e6e6e6; border-radius:14px; overflow:hidden; background:#fff;}
    .dayHeader{
      padding:12px 14px;
      background:#111;
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .dayHeader strong{font-size:15px;}
    .countBadge{
      background:#c9a227;
      color:#111;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
    }
    .slotList{padding:10px 12px 6px; display:grid; grid-template-columns: 1fr; gap:10px;}
    .slotItem{
      border:1px solid #eee;
      border-radius:12px;
      padding:10px 12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
      background:#fafafa;
    }
    .slotLeft{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .timePill{
      background:#111;
      color:#fff;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      min-width:72px;
      text-align:center;
    }
    .info{display:flex; flex-direction:column; gap:4px; font-size:13px; font-weight:700; color:#111;}
    .info small{font-weight:700; color:#666;}
    .slotRight{display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end;}
    .miniPill{
      background:#fff;
      border:1px solid #ddd;
      border-radius:999px;
      padding:6px 10px;
      font-size:12px;
      font-weight:900;
      color:#111;
    }
    .miniPill.mensalista{
      border-color:#c9a227;
      box-shadow: 0 0 0 2px rgba(201,162,39,.20);
    }

    /* ===== Modal ===== */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.65);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 999;
    }
    .overlay.show { display: flex; }

    .modalBox{
      width: 460px;
      max-width: 100%;
      background:#fff;
      border:1px solid #e6e6e6;
      border-radius:16px;
      overflow:hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
    }
    .modalHead{
      background:#111;
      color:#fff;
      padding:12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalHead strong{font-size:14px;}
    .modalBody{padding:14px;}
    .modalFoot{padding:14px; display:flex; gap:10px; justify-content:flex-end; border-top:1px solid #eee;}
    .modalFoot .btnPrimary{background:#111; border-color:#111;}

    /* ===== Modal Calendário ===== */
    .cal {
      width: 360px;
      max-width: 100%;
      background: #111;
      border: 1px solid #2a2a2a;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.55);
      color: #fff;
      font-family: Arial, sans-serif;
    }
    .cal-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 12px;
      background: #0d0d0d;
      border-bottom: 1px solid #222;
    }
    .cal-title { font-weight: 900; color: #fff; font-size: 14px; }
    .cal-nav { display: flex; gap: 8px; }
    .cal-nav button {
      border: 1px solid #2a2a2a;
      background: #151515;
      color: #fff;
      border-radius: 10px;
      padding: 8px 10px;
      cursor: pointer;
      font-weight: 900;
    }
    .cal-nav button:hover { border-color: #555; }
    .cal-body { padding: 12px; }
    .dow {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 8px;
      font-size: 11px;
      color: #bdbdbd;
      text-align: center;
      font-weight: 800;
    }
    .days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
    .day {
      border: 1px solid #2a2a2a;
      background: #141414;
      color: #fff;
      border-radius: 12px;
      padding: 10px 0;
      text-align: center;
      cursor: pointer;
      font-weight: 900;
      user-select: none;
    }
    .day:hover { border-color: #555; }
    .day.muted { opacity: .35; cursor: default; }
    .day.disabled { opacity: .25; cursor: not-allowed; }
    .day.selected {
      border-color: #c9a227;
      box-shadow: 0 0 0 2px rgba(201, 162, 39, 0.25);
    }
    .cal-foot {
      display: flex;
      gap: 10px;
      padding: 12px;
      border-top: 1px solid #222;
      background: #0d0d0d;
    }
    .cal-foot button {
      flex: 1;
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      font-weight: 900;
      border: 1px solid #2a2a2a;
      background: #151515;
      color: #fff;
    }
    .cal-foot button.primary {
      background: #c9a227;
      color: #111;
      border: none;
    }
  </style>
</head>
<body>
  <%
    function ymdToDmy(ymd) {
      if (!ymd || typeof ymd !== "string") return "";
      const m = ymd.match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if (!m) return ymd;
      // ✅ sempre DD/MM/AAAA
      return `${m[3]}/${m[2]}/${m[1]}`;
    }

    const confirmadosBase = (agendamentos || []).filter(a => a.status === "aprovado");
    const confirmados = confirmadosBase.concat(mensalistaConfirmados || []);

    const confByDate = {};
    confirmados.forEach(a => {
      const key = a.data || "";
      if (!confByDate[key]) confByDate[key] = [];
      confByDate[key].push(a);
    });
    const confDates = Object.keys(confByDate).sort((a,b) => String(a).localeCompare(String(b)));
    confDates.forEach(d => confByDate[d].sort((x,y) => String(x.horario).localeCompare(String(y.horario))));

    function weekdayLabel(n){
      const map = ["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"];
      return map[Number(n)] ?? String(n);
    }
  %>

  <header>
    <div>
      <strong>Painel Admin</strong>
      <span class="pill" style="margin-left:10px;">logado: <%= adminUser?.username %></span>
    </div>
    <form method="POST" action="/admin/logout">
      <button class="btn btnPrimary" type="submit">Sair</button>
    </form>
  </header>

  <div class="tabs">
    <button class="tabBtn active" id="tabBtnBarbeiros" type="button">Barbeiros</button>
    <button class="tabBtn" id="tabBtnConfig" type="button">Config por barbeiro</button>
    <button class="tabBtn" id="tabBtnManual" type="button">Agendar manualmente</button>
    <button class="tabBtn" id="tabBtnPendentes" type="button">Agendamentos pendentes</button>
    <button class="tabBtn" id="tabBtnConfirmados" type="button">Agendamentos confirmados</button>
    <button class="tabBtn" id="tabBtnMensalistas" type="button">Plano mensalista</button>
  </div>

  <main>
    <!-- TAB: BARBEIROS -->
    <div class="tabPanel active" id="tabBarbeiros">
      <div class="grid">
        <div class="card">
          <h2>Barbeiros</h2>
          <table>
            <thead>
              <tr>
                <th style="width:60px;">ID</th>
                <th>Nome</th>
                <th style="width:110px;">Status</th>
                <th style="width:140px;">Ação</th>
              </tr>
            </thead>
            <tbody>
              <% barbers.forEach(b => { %>
                <tr>
                  <td><%= b.id %></td>
                  <td>
                    <form method="POST" action="/admin/barbeiros/<%= b.id %>/nome" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                      <input name="name" value="<%= b.name %>" style="width:240px;" />
                      <button class="btn" type="submit">Salvar</button>
                    </form>
                  </td>
                  <td><%= b.is_active ? "Ativo" : "Inativo" %></td>
                  <td>
                    <form method="POST" action="/admin/barbeiros/<%= b.id %>/toggle" style="display:inline;">
                      <button class="btn" type="submit"><%= b.is_active ? "Desativar" : "Ativar" %></button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: CONFIG -->
    <div class="tabPanel" id="tabConfig">
      <div class="grid">
        <div class="card">
          <h2>Configuração por barbeiro</h2>

          <% barbers.forEach(b => {
              const cfg = barberConfigs[b.id];
              const dmyList = (cfg.daysOffDates || []).map(ymdToDmy).join(", ");
          %>
            <hr style="border:0; border-top:1px solid #eee; margin:18px 0;">
            <h3 style="margin:0 0 10px 0;"><%= b.name %> (ID <%= b.id %>)</h3>

            <form method="POST" action="/admin/barbeiro/<%= b.id %>/config">
              <div class="cols">
                <div>
                  <label>Início</label>
                  <input name="start" value="<%= cfg.start %>" placeholder="09:00" required />
                </div>
                <div>
                  <label>Fim</label>
                  <input name="end" value="<%= cfg.end %>" placeholder="18:00" required />
                </div>

                <div>
                  <label>Almoço (início)</label>
                  <input name="lunchStart" value="<%= cfg.lunchStart %>" placeholder="12:00" required />
                </div>
                <div>
                  <label>Almoço (fim)</label>
                  <input name="lunchEnd" value="<%= cfg.lunchEnd %>" placeholder="13:00" required />
                </div>

                <div class="full">
                  <label>Duração do slot (minutos)</label>
                  <input name="slotMinutes" type="number" value="<%= cfg.slotMinutes %>" min="10" max="240" required />
                </div>

                <div class="full">
                  <label>Dias de trabalho</label>
                  <div class="row">
                    <label><input type="checkbox" name="wd0" <%= cfg.workDays[0] ? "checked" : "" %> /> Dom</label>
                    <label><input type="checkbox" name="wd1" <%= cfg.workDays[1] ? "checked" : "" %> /> Seg</label>
                    <label><input type="checkbox" name="wd2" <%= cfg.workDays[2] ? "checked" : "" %> /> Ter</label>
                    <label><input type="checkbox" name="wd3" <%= cfg.workDays[3] ? "checked" : "" %> /> Qua</label>
                    <label><input type="checkbox" name="wd4" <%= cfg.workDays[4] ? "checked" : "" %> /> Qui</label>
                    <label><input type="checkbox" name="wd5" <%= cfg.workDays[5] ? "checked" : "" %> /> Sex</label>
                    <label><input type="checkbox" name="wd6" <%= cfg.workDays[6] ? "checked" : "" %> /> Sáb</label>
                  </div>
                </div>

                <div class="full">
                  <label>Folgas (DD/MM/AAAA, separadas por vírgula/espaco)</label>
                  <input name="daysOffDates" value="<%= dmyList %>" placeholder="10/02/2026, 11/02/2026" />
                  <div class="muted">Você pode colar também no formato yyyy-mm-dd que o sistema aceita e converte.</div>
                </div>

                <div class="full">
                  <button class="btn btnPrimary" type="submit">Salvar config do <%= b.name %></button>
                </div>
              </div>
            </form>
          <% }) %>
        </div>
      </div>
    </div>

    <!-- TAB: MANUAL -->
    <div class="tabPanel" id="tabManual">
      <div class="grid">
        <div class="card">
          <h2>Agendar manualmente</h2>
          <div class="muted">Clique no campo de data para abrir o calendário e escolher o dia.</div>

          <form method="POST" action="/admin/agendar" id="adminAgendarForm">
            <div class="cols">
              <div>
                <label>Barbeiro</label>
                <select name="barberId" id="admBarberId" required>
                  <option value="">Selecione</option>
                  <% barbers.forEach(b => { %>
                    <option value="<%= b.id %>"><%= b.name %></option>
                  <% }) %>
                </select>
              </div>

              <div>
                <label>Data (DD/MM/AAAA)</label>
                <input name="data" id="admData" placeholder="Clique para escolher" required readonly style="cursor:pointer; background:#f9f9f9;" />
                <div class="muted">Não permite selecionar data anterior a hoje.</div>
              </div>

              <div>
                <label>Horário</label>
                <select name="horario" id="admHorario" required disabled>
                  <option value="">Selecione barbeiro e data</option>
                </select>
                <div id="admHorarioMsg" class="muted"></div>
              </div>

              <div>
                <label>Status</label>
                <select name="status" id="admStatus">
                  <option value="agendado" selected>agendado</option>
                  <option value="aprovado">aprovado</option>
                  <option value="cancelado">cancelado</option>
                </select>
              </div>

              <div class="full">
                <label>Nome do cliente</label>
                <input name="nome" id="admNome" placeholder="Nome do cliente" required />
              </div>

              <div class="full">
                <button class="btn btnPrimary" type="submit">Salvar agendamento</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- TAB: PENDENTES -->
    <div class="tabPanel" id="tabPendentes">
      <div class="grid">
        <div class="card">
          <div class="row" style="justify-content:space-between;">
            <h2 style="margin:0;">Agendamentos pendentes</h2>

            <div class="row">
              <span class="muted" style="font-weight:700;">Filtrar:</span>

              <select id="barberFilter">
                <option value="">Selecione</option>
                <% barbers.forEach(b => { %>
                  <option value="<%= b.id %>"><%= b.name %></option>
                <% }) %>
              </select>

              <label style="margin:0; font-weight:900; display:flex; align-items:center; gap:8px;">
                De:
                <input type="date" id="dateFilterStart" />
              </label>

              <label style="margin:0; font-weight:900; display:flex; align-items:center; gap:8px;">
                Até:
                <input type="date" id="dateFilterEnd" />
              </label>

              <label style="margin:0; font-weight:900; display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="showCancelados" />
                Cancelados
              </label>

              <label style="margin:0; font-weight:900; display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="showAprovados" />
                Aprovados
              </label>

              <button class="toggleBtn" type="button" id="btnHoje">Hoje</button>
              <button class="toggleBtn" type="button" id="btnSemanaPend">Semana</button>
              <button class="toggleBtn" type="button" id="btnTodosDias">Todos os dias</button>
            </div>
          </div>

          <div class="muted" id="countInfo" style="margin:8px 0 12px;">—</div>

          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Hora</th>
                <th>Cliente</th>
                <th>Barbeiro</th>
                <th>Status</th>
                <th>Mudar</th>
              </tr>
            </thead>
            <tbody id="agendBody">
              <% agendamentos.forEach(a => { %>
                <tr
                  class="agRow"
                  data-id="<%= a.id %>"
                  data-barber-id="<%= a.barber_id %>"
                  data-status="<%= a.status %>"
                  data-date="<%= a.data %>"
                >
                  <td><%= ymdToDmy(a.data) %></td>
                  <td><%= a.horario %></td>
                  <td><%= a.nome %></td>
                  <td><%= a.barber_name || "" %></td>
                  <td><span class="pill jsStatusPill"><%= a.status %></span></td>
                  <td>
                    <select onchange="updateStatus(<%= a.id %>, this.value)">
                      <option value="agendado" <%= a.status==="agendado" ? "selected" : "" %>>agendado</option>
                      <option value="aprovado" <%= a.status==="aprovado" ? "selected" : "" %>>aprovado</option>
                      <option value="cancelado" <%= a.status==="cancelado" ? "selected" : "" %>>cancelado</option>
                    </select>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: CONFIRMADOS -->
    <div class="tabPanel" id="tabConfirmados">
      <div class="grid">
        <div class="card">
          <div class="row" style="justify-content:space-between;">
            <div>
              <h2 style="margin:0;">Agendamentos confirmados</h2>
              <div class="muted">
                Status <strong>aprovado</strong> + <strong>mensalistas</strong>, agrupado por dia.
                Ao entrar aqui, selecione um barbeiro e o período.
              </div>
            </div>

            <div class="row">
              <span class="muted" style="font-weight:700;">Barbeiro:</span>
              <select id="confBarberFilter">
                <option value="">Selecione</option>
                <% barbers.forEach(b => { %>
                  <option value="<%= b.id %>"><%= b.name %></option>
                <% }) %>
              </select>

              <span class="muted" style="font-weight:700;">De:</span>
              <input type="date" id="confStart" />

              <span class="muted" style="font-weight:700;">Até:</span>
              <input type="date" id="confEnd" />

              <button class="toggleBtn" type="button" id="confBtnHoje">Hoje</button>
              <button class="toggleBtn" type="button" id="confBtnSemana">Semana</button>

              <label style="margin:0; font-weight:900; display:flex; align-items:center; gap:8px;">
                <input type="checkbox" id="confOnlyMensalistas" />
                Mensalistas
              </label>

              <span class="pill" style="background:#f1f1f1;">Total: <span id="confTotal"><%= confirmados.length %></span></span>
            </div>
          </div>

          <div id="confHint" class="bad" style="display:none; margin-top:10px;">
            Selecione um barbeiro para listar os confirmados.
          </div>
        </div>

        <div class="card">
          <% if (!confirmados.length) { %>
            <div class="muted">Nenhum confirmado (aprovado/mensalista) até o momento.</div>
          <% } else { %>
            <div class="agendaWrap" id="confAgenda">
              <% confDates.forEach(dateKey => {
                   const items = confByDate[dateKey] || [];
              %>
                <div class="dayCard confDayCard" data-date="<%= dateKey %>">
                  <div class="dayHeader">
                    <strong><%= ymdToDmy(dateKey) %></strong>
                    <span class="countBadge"><span class="confDayCount"><%= items.length %></span> horário(s)</span>
                  </div>

                  <div class="slotList">
                    <% items.forEach(a => { %>
                      <div
                        class="slotItem confSlot"
                        data-barber-id="<%= a.barber_id %>"
                        data-is-mensalista="<%= a.is_mensalista ? '1' : '0' %>"
                      >
                        <div class="slotLeft">
                          <span class="timePill"><%= a.horario %></span>
                          <div class="info">
                            <div><%= a.nome %></div>
                            <small>
                              Barbeiro: <%= a.barber_name || "" %>
                            </small>
                          </div>
                        </div>
                        <div class="slotRight">
                          <% if (a.is_mensalista) { %>
                            <span class="miniPill mensalista">mensalista</span>
                          <% } else { %>
                            <span class="miniPill">confirmado</span>
                          <% } %>
                        </div>
                      </div>
                    <% }) %>
                  </div>
                </div>
              <% }) %>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- TAB: PLANO MENSALISTA -->
    <div class="tabPanel" id="tabMensalistas">
      <div class="grid">
        <div class="card">
          <h2>Plano mensalista</h2>
          <div class="muted">
            Cria um bloqueio fixo semanal (ex.: toda quarta 18:30). Esse horário fica indisponível no agendamento público.
          </div>

          <div id="menEditPill" class="pill" style="display:none; margin-top:10px; background:#fff5cf; border:1px solid #e6d18a;">
            Editando mensalista: <strong id="menEditName"></strong>
          </div>

          <form method="POST" action="/admin/mensalistas" id="mensalistaForm" style="margin-top:12px;">
            <input type="hidden" id="menPlanId" value="" />
            <div class="cols">
              <div>
                <label>Barbeiro</label>
                <select name="barberId" id="menBarberId" required>
                  <option value="">Selecione</option>
                  <% barbers.forEach(b => { %>
                    <option value="<%= b.id %>"><%= b.name %></option>
                  <% }) %>
                </select>
              </div>

              <div>
                <label>Nome do mensalista</label>
                <input name="nome" id="menNome" placeholder="Ex: Gabriel Honorato" required />
              </div>

              <div>
                <label>Data início do plano</label>
                <input type="date" name="start" id="menStart" required />
                <div class="muted">A data de início precisa bater com o dia da semana escolhido.</div>
              </div>

              <div>
                <label>Data fim do plano (opcional)</label>
                <input type="date" name="end" id="menEnd" />
                <div class="muted">Deixe em branco para “sem previsão de término”.</div>
              </div>

              <div>
                <label>Dia da semana</label>
                <select name="weekday" id="menWeekday" required>
                  <option value="">Selecione</option>
                  <option value="0">Domingo</option>
                  <option value="1">Segunda</option>
                  <option value="2">Terça</option>
                  <option value="3">Quarta</option>
                  <option value="4">Quinta</option>
                  <option value="5">Sexta</option>
                  <option value="6">Sábado</option>
                </select>
                <div class="muted" id="menWeekdayHint"></div>
              </div>

              <div>
                <label>Horário</label>
                <select name="horario" id="menHorario" required disabled>
                  <option value="">Selecione barbeiro e data início</option>
                </select>
                <div class="muted" id="menHorarioMsg"></div>
              </div>

              <div class="full" style="display:flex; gap:10px; flex-wrap:wrap;">
                <button class="btn btnPrimary" type="submit" id="menSubmitBtn">Salvar plano mensalista</button>
                <button class="btn" type="button" id="menCancelEdit" style="display:none;">Cancelar edição</button>
              </div>
            </div>
          </form>
        </div>

        <div class="card">
          <h2 style="margin-bottom:6px;">Mensalistas cadastrados</h2>
          <div class="muted" style="margin-bottom:10px;">
            Lista de bloqueios semanais ativos/cadastrados.
          </div>

          <% if (!(mensalistas || []).length) { %>
            <div class="muted">Nenhum plano mensalista cadastrado ainda.</div>
          <% } else { %>
            <table>
              <thead>
                <tr>
                  <th>Barbeiro</th>
                  <th>Nome</th>
                  <th>Início</th>
                  <th>Fim</th>
                  <th>Dia</th>
                  <th>Horário</th>
                  <th style="width:210px;">Ações</th>
                </tr>
              </thead>
              <tbody>
                <% mensalistas.forEach(m => { %>
                  <tr
                    data-men-id="<%= m.id %>"
                    data-men-barber-id="<%= m.barber_id %>"
                    data-men-nome="<%- String(m.nome || '').replace(/\"/g, '&quot;') %>"
                    data-men-start="<%= m.start_ymd %>"
                    data-men-end="<%= m.end_ymd || '' %>"
                    data-men-weekday="<%= m.weekday %>"
                    data-men-horario="<%= m.horario %>"
                  >
                    <td><%= m.barber_name || m.barber_id %></td>
                    <td><%= m.nome %></td>
                    <td><%= ymdToDmy(m.start_ymd) %></td>
                    <td><%= m.end_ymd ? ymdToDmy(m.end_ymd) : "—" %></td>
                    <td><%= weekdayLabel(m.weekday) %></td>
                    <td><%= m.horario %></td>
                    <td style="display:flex; gap:8px; flex-wrap:wrap;">
                      <button class="btn" type="button" onclick="startEditMensalista(this)">Editar</button>

                      <form method="POST" action="/admin/mensalistas/<%= m.id %>/delete" onsubmit="return confirm('Remover este plano mensalista?');">
                        <button class="btn" type="submit">Remover</button>
                      </form>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          <% } %>
        </div>
      </div>
    </div>
  </main>

  <!-- Modal: Pendentes -->
  <div id="pendOverlay" class="overlay" aria-hidden="true">
    <div class="modalBox" role="dialog" aria-modal="true" aria-label="Filtro de pendentes">
      <div class="modalHead">
        <strong>Filtrar pendentes</strong>
        <span class="pill" style="background:#222; color:#fff;">obrigatório</span>
      </div>
      <div class="modalBody">
        <div class="muted">Selecione o barbeiro e o período.</div>

        <label>Barbeiro</label>
        <select id="pendModalBarber">
          <option value="">Selecione</option>
          <% barbers.forEach(b => { %>
            <option value="<%= b.id %>"><%= b.name %></option>
          <% }) %>
        </select>

        <div class="cols" style="margin-top:8px;">
          <div>
            <label>De</label>
            <input type="date" id="pendModalStart" />
          </div>
          <div>
            <label>Até</label>
            <input type="date" id="pendModalEnd" />
          </div>
        </div>

        <div class="muted" style="margin-top:10px;">
          Padrão: hoje até hoje + 7 dias.
        </div>
      </div>
      <div class="modalFoot">
        <button class="btn" type="button" id="pendModalSemana">Semana</button>
        <button class="btn btnPrimary" type="button" id="pendModalApply">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- Modal: Confirmados -->
  <div id="confOverlay" class="overlay" aria-hidden="true">
    <div class="modalBox" role="dialog" aria-modal="true" aria-label="Filtro de confirmados">
      <div class="modalHead">
        <strong>Filtrar confirmados</strong>
        <span class="pill" style="background:#222; color:#fff;">obrigatório</span>
      </div>
      <div class="modalBody">
        <div class="muted">Selecione o barbeiro e confirme o período.</div>

        <label>Barbeiro</label>
        <select id="confModalBarber">
          <option value="">Selecione</option>
          <% barbers.forEach(b => { %>
            <option value="<%= b.id %>"><%= b.name %></option>
          <% }) %>
        </select>

        <div class="cols" style="margin-top:8px;">
          <div>
            <label>De</label>
            <input type="date" id="confModalStart" />
          </div>
          <div>
            <label>Até</label>
            <input type="date" id="confModalEnd" />
          </div>
        </div>

        <div class="muted" style="margin-top:10px;">
          “Semana” = data inicial até o mesmo dia da semana seguinte.
        </div>
      </div>
      <div class="modalFoot">
        <button class="btn" type="button" id="confModalSemana">Semana</button>
        <button class="btn btnPrimary" type="button" id="confModalApply">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- Modal Calendário -->
  <div id="admOverlay" class="overlay" aria-hidden="true">
    <div class="cal" role="dialog" aria-modal="true" aria-label="Selecionar data">
      <div class="cal-head">
        <div class="cal-title" id="admCalTitle">Mês</div>
        <div class="cal-nav">
          <button type="button" id="admPrevMonth">◀</button>
          <button type="button" id="admNextMonth">▶</button>
        </div>
      </div>

      <div class="cal-body">
        <div class="dow">
          <div>DOM</div><div>SEG</div><div>TER</div><div>QUA</div><div>QUI</div><div>SEX</div><div>SÁB</div>
        </div>
        <div id="admDays" class="days"></div>
      </div>

      <div class="cal-foot">
        <button type="button" id="admCancelCal">Cancelar</button>
        <button type="button" class="primary" id="admOkCal">Confirmar</button>
      </div>
    </div>
  </div>

  <script>
    function pad2(n){ return String(n).padStart(2, "0"); }
    function fmtYMD(d){ return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`; }
    function addDays(d, days){ const x = new Date(d.getTime()); x.setDate(x.getDate()+days); return x; }
    function parseYMD(ymd){
      if(!ymd) return null;
      const m = String(ymd).match(/^(\d{4})-(\d{2})-(\d{2})$/);
      if(!m) return null;
      return new Date(Number(m[1]), Number(m[2])-1, Number(m[3]));
    }
    // ✅ aceita DD/MM/AAAA ou DD-MM-AAAA
    function dmyToYMD(dmy){
      if(!dmy) return null;
      const m = String(dmy).match(/^(\d{2})[\/\-](\d{2})[\/\-](\d{4})$/);
      if(!m) return null;
      return `${m[3]}-${m[2]}-${m[1]}`;
    }
    function minutesNow(){
      const n = new Date();
      return n.getHours() * 60 + n.getMinutes();
    }
    function timeToMinutes(hhmm){
      const m = String(hhmm || "").match(/^(\d{2}):(\d{2})$/);
      if(!m) return null;
      return Number(m[1]) * 60 + Number(m[2]);
    }

    const tabs = [
      { btn: "tabBtnBarbeiros", panel:"tabBarbeiros" },
      { btn: "tabBtnConfig", panel:"tabConfig" },
      { btn: "tabBtnManual", panel:"tabManual" },
      { btn: "tabBtnPendentes", panel:"tabPendentes" },
      { btn: "tabBtnConfirmados", panel:"tabConfirmados" },
      { btn: "tabBtnMensalistas", panel:"tabMensalistas" },
    ];

    // ✅ reset do formulário manual
    function resetManualForm(){
      const form = document.getElementById("adminAgendarForm");
      const admBarberId = document.getElementById("admBarberId");
      const admData = document.getElementById("admData");
      const admHorario = document.getElementById("admHorario");
      const admHorarioMsg = document.getElementById("admHorarioMsg");
      const admNome = document.getElementById("admNome");
      const admStatus = document.getElementById("admStatus");

      if(form) form.reset();
      if(admBarberId) admBarberId.value = "";
      if(admData) admData.value = "";
      if(admNome) admNome.value = "";
      if(admStatus) admStatus.value = "agendado";

      if(admHorario){
        admHorario.innerHTML = `<option value="">Selecione barbeiro e data</option>`;
        admHorario.disabled = true;
      }
      if(admHorarioMsg) admHorarioMsg.textContent = "";
    }

    function activateTab(btnId){
      tabs.forEach(t=>{
        const b = document.getElementById(t.btn);
        const p = document.getElementById(t.panel);
        const active = (t.btn === btnId);
        b.classList.toggle("active", active);
        p.classList.toggle("active", active);
      });

      if(btnId === "tabBtnPendentes"){
        openPendOverlay(true);
      }
      if(btnId === "tabBtnConfirmados"){
        openConfOverlay(true);
      }

      // ✅ quando entrar no manual, limpa tudo
      if(btnId === "tabBtnManual"){
        resetManualForm();
      }
    }

    tabs.forEach(t=>{
      document.getElementById(t.btn).addEventListener("click", ()=>activateTab(t.btn));
    });

    async function updateStatus(id, status){
      try{
        const r = await fetch("/admin/status", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ id, status })
        });
        const j = await r.json();
        if(!j.ok) throw new Error("fail");
        const row = document.querySelector(`tr.agRow[data-id="${id}"]`);
        if(row){
          row.dataset.status = status;
          const pill = row.querySelector(".jsStatusPill");
          if(pill) pill.textContent = status;
        }
        applyPendentesFilter();
      }catch(e){
        alert("Erro ao mudar status.");
      }
    }
    window.updateStatus = updateStatus;

    const barberFilter = document.getElementById("barberFilter");
    const dateFilterStart = document.getElementById("dateFilterStart");
    const dateFilterEnd = document.getElementById("dateFilterEnd");
    const showCancelados = document.getElementById("showCancelados");
    const showAprovados = document.getElementById("showAprovados");
    const countInfo = document.getElementById("countInfo");

    function setPendDates(startYMD, endYMD){
      dateFilterStart.value = startYMD || "";
      dateFilterEnd.value = endYMD || "";
    }

    function applyPendentesFilter(){
      const bId = barberFilter.value;
      const start = dateFilterStart.value;
      const end = dateFilterEnd.value;

      const allowCancel = !!showCancelados.checked;
      const allowAprov = !!showAprovados.checked;

      let shown = 0;
      document.querySelectorAll(".agRow").forEach(tr=>{
        const trBarber = tr.dataset.barberId;
        const st = tr.dataset.status;
        const dt = tr.dataset.date;

        let ok = true;

        if(!bId) ok = false;
        if(ok && trBarber !== bId) ok = false;

        if(ok && start && dt < start) ok = false;
        if(ok && end && dt > end) ok = false;

        if(ok){
          if(st === "cancelado" && !allowCancel) ok = false;
          if(st === "aprovado" && !allowAprov) ok = false;

          if(st !== "agendado" && st !== "aprovado" && st !== "cancelado") ok = false;
          if(st === "agendado") ok = true;
          if(st === "cancelado") ok = allowCancel;
          if(st === "aprovado") ok = allowAprov;
        }

        tr.style.display = ok ? "" : "none";
        if(ok) shown++;
      });

      countInfo.textContent = `Mostrando ${shown} agendamento(s)`;
    }

    [barberFilter, dateFilterStart, dateFilterEnd, showCancelados, showAprovados].forEach(el=>{
      el.addEventListener("change", applyPendentesFilter);
    });

    const btnHoje = document.getElementById("btnHoje");
    const btnSemanaPend = document.getElementById("btnSemanaPend");
    const btnTodosDias = document.getElementById("btnTodosDias");

    function setToggleActive(btn){
      [btnHoje, btnSemanaPend, btnTodosDias].forEach(b=>b.classList.remove("active"));
      if(btn) btn.classList.add("active");
    }

    btnHoje.addEventListener("click", ()=>{
      const t = new Date();
      const y = fmtYMD(t);
      setPendDates(y, y);
      setToggleActive(btnHoje);
      applyPendentesFilter();
    });
    btnSemanaPend.addEventListener("click", ()=>{
      const t = new Date();
      const s = fmtYMD(t);
      const e = fmtYMD(addDays(t, 7));
      setPendDates(s, e);
      setToggleActive(btnSemanaPend);
      applyPendentesFilter();
    });
    btnTodosDias.addEventListener("click", ()=>{
      setPendDates("", "");
      setToggleActive(btnTodosDias);
      applyPendentesFilter();
    });

    const confBarberFilter = document.getElementById("confBarberFilter");
    const confStart = document.getElementById("confStart");
    const confEnd = document.getElementById("confEnd");
    const confHint = document.getElementById("confHint");
    const confTotal = document.getElementById("confTotal");

    const confBtnHoje = document.getElementById("confBtnHoje");
    const confBtnSemana = document.getElementById("confBtnSemana");
    const confOnlyMensalistas = document.getElementById("confOnlyMensalistas");

    function setConfToggleActive(btn){
      [confBtnHoje, confBtnSemana].forEach(b=>b.classList.remove("active"));
      if(btn) btn.classList.add("active");
    }

    function applyConfirmados(){
      const bId = confBarberFilter.value;
      const start = confStart.value;
      const end = confEnd.value;

      const onlyMen = !!confOnlyMensalistas?.checked;

      if(!bId){
        confHint.style.display = "";
      }else{
        confHint.style.display = "none";
      }

      let totalShown = 0;
      document.querySelectorAll(".confDayCard").forEach(card=>{
        const dateKey = card.dataset.date;
        let dayCount = 0;

        const inRange =
          (!start || dateKey >= start) &&
          (!end || dateKey <= end);

        card.querySelectorAll(".confSlot").forEach(slot=>{
          const sb = slot.dataset.barberId;
          const isMen = slot.dataset.isMensalista === "1";

          const ok =
            !!bId &&
            sb === bId &&
            inRange &&
            (!onlyMen || isMen);

          slot.style.display = ok ? "" : "none";
          if(ok){ dayCount++; totalShown++; }
        });

        const badge = card.querySelector(".confDayCount");
        if(badge) badge.textContent = String(dayCount);

        card.style.display = (dayCount > 0) ? "" : "none";
      });

      confTotal.textContent = String(totalShown);
    }

    confBarberFilter.addEventListener("change", ()=>{
      setConfToggleActive(null);
      applyConfirmados();
    });
    confStart.addEventListener("change", ()=>{
      setConfToggleActive(null);
      applyConfirmados();
    });
    confEnd.addEventListener("change", ()=>{
      setConfToggleActive(null);
      applyConfirmados();
    });
    confOnlyMensalistas.addEventListener("change", applyConfirmados);

    confBtnHoje.addEventListener("click", ()=>{
      const t = new Date();
      const y = fmtYMD(t);
      confStart.value = y;
      confEnd.value = y;
      setConfToggleActive(confBtnHoje);
      applyConfirmados();
    });

    confBtnSemana.addEventListener("click", ()=>{
      const t = new Date();
      const s = fmtYMD(t);
      const e = fmtYMD(addDays(t, 7));
      confStart.value = s;
      confEnd.value = e;
      setConfToggleActive(confBtnSemana);
      applyConfirmados();
    });

    const pendOverlay = document.getElementById("pendOverlay");
    const pendModalBarber = document.getElementById("pendModalBarber");
    const pendModalStart = document.getElementById("pendModalStart");
    const pendModalEnd = document.getElementById("pendModalEnd");
    const pendModalApply = document.getElementById("pendModalApply");
    const pendModalSemana = document.getElementById("pendModalSemana");

    function openPendOverlay(forceReset){
      if(forceReset){
        const t = new Date();
        pendModalStart.value = fmtYMD(t);
        pendModalEnd.value = fmtYMD(addDays(t, 7));
        pendModalBarber.value = "";
      }
      pendOverlay.classList.add("show");
    }
    function closePendOverlay(){
      pendOverlay.classList.remove("show");
    }

    pendModalSemana.addEventListener("click", ()=>{
      const s = pendModalStart.value ? parseYMD(pendModalStart.value) : new Date();
      pendModalStart.value = fmtYMD(s);
      pendModalEnd.value = fmtYMD(addDays(s, 7));
    });

    pendModalApply.addEventListener("click", ()=>{
      const b = pendModalBarber.value;
      const s = pendModalStart.value;
      const e = pendModalEnd.value;

      if(!b){
        alert("Selecione o barbeiro.");
        return;
      }
      if(s && e && e < s){
        alert("Período inválido.");
        return;
      }

      barberFilter.value = b;
      setPendDates(s, e);
      closePendOverlay();

      setToggleActive(null);
      applyPendentesFilter();
    });

    const confOverlay = document.getElementById("confOverlay");
    const confModalBarber = document.getElementById("confModalBarber");
    const confModalStart = document.getElementById("confModalStart");
    const confModalEnd = document.getElementById("confModalEnd");
    const confModalApply = document.getElementById("confModalApply");
    const confModalSemana = document.getElementById("confModalSemana");

    function openConfOverlay(forceReset){
      if(forceReset){
        const t = new Date();
        confModalStart.value = fmtYMD(t);
        confModalEnd.value = fmtYMD(addDays(t, 7));
        confModalBarber.value = "";
      }
      confOverlay.classList.add("show");
    }
    function closeConfOverlay(){
      confOverlay.classList.remove("show");
    }

    confModalSemana.addEventListener("click", ()=>{
      const s = confModalStart.value ? parseYMD(confModalStart.value) : new Date();
      confModalStart.value = fmtYMD(s);
      confModalEnd.value = fmtYMD(addDays(s, 7));
    });

    confModalApply.addEventListener("click", ()=>{
      const b = confModalBarber.value;
      const s = confModalStart.value;
      const e = confModalEnd.value;

      if(!b){
        alert("Selecione o barbeiro.");
        return;
      }
      if(s && e && e < s){
        alert("Período inválido.");
        return;
      }

      confBarberFilter.value = b;
      confStart.value = s;
      confEnd.value = e;
      closeConfOverlay();

      setConfToggleActive(null);
      applyConfirmados();
    });

    const admOverlay = document.getElementById("admOverlay");
    const admData = document.getElementById("admData");
    const admBarberId = document.getElementById("admBarberId");
    const admHorario = document.getElementById("admHorario");
    const admHorarioMsg = document.getElementById("admHorarioMsg");

    const admCalTitle = document.getElementById("admCalTitle");
    const admDays = document.getElementById("admDays");
    const admPrevMonth = document.getElementById("admPrevMonth");
    const admNextMonth = document.getElementById("admNextMonth");
    const admCancelCal = document.getElementById("admCancelCal");
    const admOkCal = document.getElementById("admOkCal");

    let calMonth = new Date();
    let selectedYMD = null;

    function openAdmCal(){
      // se já tem data no input, abre o mês dela
      const ymd = dmyToYMD(admData.value);
      if(ymd){
        selectedYMD = ymd;
        const d = parseYMD(ymd);
        if(d) calMonth = new Date(d.getFullYear(), d.getMonth(), 1);
      }else{
        const now = new Date();
        calMonth = new Date(now.getFullYear(), now.getMonth(), 1);
        selectedYMD = null;
      }

      admOverlay.classList.add("show");
      renderCal();
    }
    function closeAdmCal(){
      admOverlay.classList.remove("show");
    }

    function renderCal(){
      const y = calMonth.getFullYear();
      const m = calMonth.getMonth();
      const monthNames = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
      admCalTitle.textContent = `${monthNames[m]} ${y}`;

      const first = new Date(y, m, 1);
      const startDow = first.getDay();
      const daysInMonth = new Date(y, m+1, 0).getDate();

      // hoje (00:00)
      const today = new Date();
      const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const todayYMD = fmtYMD(todayStart);

      admDays.innerHTML = "";

      for(let i=0;i<startDow;i++){
        const div = document.createElement("div");
        div.className = "day muted";
        div.textContent = "";
        admDays.appendChild(div);
      }

      for(let d=1; d<=daysInMonth; d++){
        const dt = new Date(y, m, d);
        const ymd = fmtYMD(dt);
        const div = document.createElement("div");
        div.className = "day";
        div.textContent = String(d);

        // ✅ bloqueia datas anteriores a hoje
        if(dt < todayStart){
          div.classList.add("disabled");
        }else{
          div.addEventListener("click", ()=>{
            selectedYMD = ymd;
            renderCal();
          });
        }

        if(selectedYMD === ymd) div.classList.add("selected");

        // se não tem selected ainda, pré-seleciona hoje ao abrir
        if(!selectedYMD && ymd === todayYMD){
          selectedYMD = todayYMD;
          div.classList.add("selected");
        }

        admDays.appendChild(div);
      }
    }

    admPrevMonth.addEventListener("click", ()=>{ calMonth = new Date(calMonth.getFullYear(), calMonth.getMonth()-1, 1); renderCal(); });
    admNextMonth.addEventListener("click", ()=>{ calMonth = new Date(calMonth.getFullYear(), calMonth.getMonth()+1, 1); renderCal(); });
    admCancelCal.addEventListener("click", closeAdmCal);
    admOkCal.addEventListener("click", ()=>{
      if(!selectedYMD) { alert("Selecione uma data."); return; }

      // ✅ segurança: não deixa confirmar data passada
      const today = new Date();
      const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const sel = parseYMD(selectedYMD);
      if(sel && sel < todayStart){
        alert("Não é permitido selecionar data anterior a hoje.");
        return;
      }

      const d = parseYMD(selectedYMD);
      // ✅ sempre DD/MM/AAAA no input
      admData.value = `${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()}`;

      closeAdmCal();
      refreshAdminHorarios();
    });

    admData.addEventListener("click", openAdmCal);

    async function refreshAdminHorarios(){
      admHorario.innerHTML = `<option value="">Selecione barbeiro e data</option>`;
      admHorario.disabled = true;
      admHorarioMsg.textContent = "";

      const b = admBarberId.value;
      const dmy = admData.value;
      if(!b || !dmy) return;

      const ymd = dmyToYMD(dmy);
      if(!ymd) return;

      // ✅ segurança: não carrega horários para data passada
      const today = new Date();
      const todayYMD = fmtYMD(new Date(today.getFullYear(), today.getMonth(), today.getDate()));
      if(ymd < todayYMD){
        admHorarioMsg.textContent = "Não é permitido agendar em data anterior a hoje.";
        return;
      }

      try{
        const r = await fetch(`/horarios?barberId=${encodeURIComponent(b)}&data=${encodeURIComponent(ymd)}`);
        const slots = await r.json();

        let finalSlots = Array.isArray(slots) ? slots.slice() : [];

        // ✅ regra do "horário ao vivo" SOMENTE para hoje: precisa ter pelo menos 10 min de antecedência
        if(ymd === todayYMD){
          const nowMin = minutesNow();
          finalSlots = finalSlots.filter(h=>{
            const slotMin = timeToMinutes(h);
            if(slotMin == null) return false;
            return (slotMin - nowMin) >= 10; // 16:50 -> 17:00 (10) OK / 16:51 -> 17:00 (9) NÃO
          });
        }

        if(!finalSlots.length){
          admHorario.innerHTML = `<option value="">Sem horários disponíveis</option>`;
          admHorario.disabled = true;

          if(ymd === todayYMD){
            admHorarioMsg.textContent = "Sem horários disponíveis para hoje (mín. 10 min de antecedência).";
          }else{
            admHorarioMsg.textContent = "Sem horários disponíveis para esta data.";
          }
          return;
        }

        admHorario.innerHTML = `<option value="">Selecione</option>` + finalSlots.map(h=>`<option value="${h}">${h}</option>`).join("");
        admHorario.disabled = false;

        if(ymd === todayYMD){
          admHorarioMsg.textContent = "Regra hoje: só aparece horário com pelo menos 10 min de antecedência.";
        }
      }catch(e){
        admHorarioMsg.textContent = "Erro ao carregar horários.";
      }
    }
    admBarberId.addEventListener("change", refreshAdminHorarios);

    // ✅ validação no submit (pra não burlar)
    document.getElementById("adminAgendarForm")?.addEventListener("submit", (e)=>{
      const b = admBarberId.value;
      const dmy = admData.value;
      const h = admHorario.value;

      if(!b || !dmy || !h) return;

      const ymd = dmyToYMD(dmy);
      if(!ymd){
        e.preventDefault();
        alert("Data inválida.");
        return;
      }

      const today = new Date();
      const todayYMD = fmtYMD(new Date(today.getFullYear(), today.getMonth(), today.getDate()));

      if(ymd < todayYMD){
        e.preventDefault();
        alert("Não é permitido agendar em data anterior a hoje.");
        return;
      }

      if(ymd === todayYMD){
        const nowMin = minutesNow();
        const slotMin = timeToMinutes(h);
        if(slotMin == null || (slotMin - nowMin) < 10){
          e.preventDefault();
          alert("Horário inválido para hoje. Regra: mínimo 10 minutos de antecedência (tolerância 0).");
          return;
        }
      }
    });

    // ===== boot =====
    applyPendentesFilter();
    applyConfirmados();

    // ✅ abre aba via query param (ex.: /admin?tab=manual)
    document.addEventListener("DOMContentLoaded", ()=>{
      const tab = new URLSearchParams(window.location.search).get("tab");
      if(tab === "manual") activateTab("tabBtnManual");
      if(tab === "pendentes") activateTab("tabBtnPendentes");
      if(tab === "confirmados") activateTab("tabBtnConfirmados");
      if(tab === "mensalistas") activateTab("tabBtnMensalistas");
      if(tab === "config") activateTab("tabBtnConfig");
      if(tab === "barbeiros") activateTab("tabBtnBarbeiros");
    });
  </script>

</body>
</html>